/**
 * @description
 * @author anpatil-dt
 */
rule Rules.onDayCalculationTrigger {
	attribute {
		priority = 5;
		forwardChain = true;
	}
	declare {
		Events.CalculationTrigger e;
	}
	when {
		e.period == "day";
	}
	then {
		int duration = 7;
		System.debugOut("Computing tickers for "+e.Ticker+" for "+duration+" "+e.period+"(s)");
		//get current time
		DateTime now = DateTime.now();
		//go back specified duration day
		DateTime.addDay(now,-duration);
		long timeMsecs = DateTime.getTimeInMillis(now);
		//calculate price for the specified days @ hour resolution
		for (int i = 0 ; i < duration*24 ; i++){
			Dashboards.Metrics.HourlyTickerMetric.compute(DateTime.parseLong(timeMsecs), e.Ticker, Math.random()*100, Math.random() * 10000);
			timeMsecs = timeMsecs + 60*60*1000;
		}
	}
}