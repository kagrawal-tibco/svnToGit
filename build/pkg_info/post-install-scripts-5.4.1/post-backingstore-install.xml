<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="post-install" default="post-install" basedir=".">
	<property file="post-install.properties"/>
	<import file="common-tasks.xml"/>
	
	<taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
	
	<target name="post-install" depends="import-wrappers, 
										 set-subst-vars,
										 bkp-tra-files">
		<echo message="Done post-installation tasks." />
	</target>

	<target name="import-wrappers">
		<echo message="Copying be-jdbcdeploy wrapper..." />
		<copy file="${tibco.home}/tools/wrapper/wrap${tibco.wrapper.extension}"
			tofile="${tibco.home}/be/${beVersionShort}/bin/be-jdbcdeploy${tibco.wrapper.extension}" />
		<chmod file="${tibco.home}/be/${beVersionShort}/bin/be-jdbcdeploy${tibco.wrapper.extension}" perm="755" />
		<echo message="Copying be-migration wrapper..." />
		<copy file="${tibco.home}/tools/wrapper/wrap${tibco.wrapper.extension}"
			tofile="${tibco.home}/be/${beVersionShort}/bin/be-migration${tibco.wrapper.extension}" />
		<chmod file="${tibco.home}/be/${beVersionShort}/bin/be-migration${tibco.wrapper.extension}" perm="755" />		
	</target>
	
	<target name="set-subst-vars">
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/bin/be-jdbcdeploy.tra"/>
		</antcall>
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/bin/be-migration.tra"/>
		</antcall>
		<antcall target="substitute-variables-examples">
			<param name="examples-path" value="${tibco.home}/be/${beVersionShort}/examples/standard/FraudDetectionCache" />
		</antcall>
		<antcall target="substitute-variables-examples">
			<param name="examples-path" value="${tibco.home}/be/${beVersionShort}/examples/standard/FraudDetectionStore" />
		</antcall>
		<antcall target="substitute-variables-examples">
			<param name="examples-path" value="${tibco.home}/be/${beVersionShort}/examples/standard/Locking" />
		</antcall>
	</target>
	
	<target name="bkp-tra-files">
		<echo message="Backing up tra files"/>
		<mkdir dir="${tibco.home}/be/5.4/backup/5.4.1_pre/bin" />
		
		<if>
			<not>
				<available file="${tibco.home}/be/5.4/backup/5.4.1_pre/bin/be-jdbcdeploy.tra" type="file"/>
			</not>
			<then>
				<echo message="Backing up tra ${tibco.home}/be/5.4/bin/be-jdbcdeploy.tra"/>
				<copy file="${tibco.home}/be/5.4/bin/be-jdbcdeploy.tra" todir="${tibco.home}/be/5.4/backup/5.4.1_pre/bin"/>
			</then>
		</if>
		
		<if>
			<not>
				<available file="${tibco.home}/be/5.4/backup/5.4.1_pre/bin/be-migration.tra" type="file"/>
			</not>
			<then>
				<echo message="Backing up tra ${tibco.home}/be/5.4/bin/be-migration.tra"/>
				<copy file="${tibco.home}/be/5.4/bin/be-migration.tra" todir="${tibco.home}/be/5.4/backup/5.4.1_pre/bin"/>
			</then>
		</if>
	</target>	
</project>	
