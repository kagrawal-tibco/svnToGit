<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="post-install" default="post-install" basedir=".">
	<property file="post-install.properties"/>
	<import file="common-tasks.xml"/>	
	
    <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
	
	<target name="post-install" depends="import-wrappers,
					     				set-subst-vars,create-dirs,update-web-xml,update-rms-cdd">
		<echo message="Done post-installation tasks." />
	</target>

	<target name="import-wrappers">
		<echo message="Copying be-rms wrapper..." />
		<if>
			<os family="mac"/>
			<then>
				<copy file="${tibco.home}/tools/wrapper/gwrap${tibco.wrapper.extension}"
					tofile="${tibco.home}/be/${beVersionShort}/rms/bin/be-rms${tibco.wrapper.extension}" />
			</then>
			<else>
				<copy file="${tibco.home}/tools/wrapper/wrap${tibco.wrapper.extension}"
					tofile="${tibco.home}/be/${beVersionShort}/rms/bin/be-rms${tibco.wrapper.extension}" />
			</else>
		</if>
		<chmod file="${tibco.home}/be/${beVersionShort}/rms/bin/be-rms${tibco.wrapper.extension}" perm="755" />
	</target>
	
	<target name="set-subst-vars">
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/bin/be-rms.tra"/>
		</antcall>
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/bin/RMS.cdd"/>
		</antcall>
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/project/BRMS/Deployment/RMS.cdd"/>
		</antcall>
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/project/BRMS/.beproject"/>
		</antcall>		
	</target>
	
	<target name="create-dirs">
			<mkdir dir="${tibco.home}/be/${beVersionShort}/rms/shared"/>
	</target>
	
	<target name="update-web-xml">
	        <unjar dest="${tibco.home}/be/${beVersionShort}/rms/bin/temp_ws" src="${tibco.home}/be/${beVersionShort}/rms/bin/WebStudio.war">
	        </unjar>
			<replace file="${tibco.home}/be/${beVersionShort}/rms/bin/temp_ws/WEB-INF/web.xml" token="%TIBCO_BE_HOME_ESC%" value="${tibco.home}/be/${beVersionShort}" />
	        <delete file="${tibco.home}/be/${beVersionShort}/rms/bin/WebStudio.war" />
	        <jar destfile="${tibco.home}/be/${beVersionShort}/rms/bin/WebStudio.war" basedir="${tibco.home}/be/${beVersionShort}/rms/bin/temp_ws">
	        </jar>
	        <delete dir="${tibco.home}/be/5.6/rms/bin/temp_ws" />
		</target>
	
	<target name="update-rms-cdd">
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/bin/RMS.cdd"/>
		</antcall>
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/project/BRMS/Deployment/RMS.cdd"/>
		</antcall>
		<antcall target="substitute-variables">
			<param name="out.file" value="${tibco.home}/be/${beVersionShort}/rms/project/BRMS/.beproject"/>
		</antcall>
	</target>
	
</project>	
