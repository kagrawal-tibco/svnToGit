<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>     Fraud Detection Secure

- TIBCO BusinessEvents&reg; Examples
</title>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="Content-Language" content="en-us" />
<link rel="Shortcut Icon" href="../../_resources/icon.gif" type="image/gif" />
<style type="text/css" media="all">@import "../../_resources/examples.css";</style>
<script type="text/javascript" src="../../_resources/examples.js" /></script>
<script type="text/javascript">
function buildForms() {
 var form;

 SendEventForm.setServer("https://localhost:8109");

 form = SendEventForm.get("createAccountForm");
 form.setDestinationPath("/Channels/HTTP/AllOps");
 form.setEventPath("/Events/CreateAccount");
 form.addProperty("AccountId", "Bob");
 form.addProperty("PinCode", "1234", 1, "password");
 form.addProperty("Balance", "20000");
 form.addProperty("AvgMonthlyBalance", "11000");
 form.build();


 form = SendEventForm.get("debitAccountForm");
 form.setDestinationPath("/Channels/HTTP/AllOps");
 form.setEventPath("/Events/Debit");
 form.addProperty("AccountId", "Bob");
 form.addProperty("PinCode", "1234", 1, "password");
 form.addProperty("Amount", "1000");
 form.build();


}
</script>
</head>
<body onLoad="buildForms()">


<h1>Fraud Detection Secure</h1>

Fraud Detection is a commonly used scenario for highlighting what's different about CEP because it shows how the CEP engine correlates different events using a time window or other criteria. In this example, fraud is suspected when either of the following occurs:</p>
<ul>
<li>The account incurs more than three debit transactions in a two minute period.</li>
<li>The sum of the debits that occurs in a two minute period totals more than 80% of the average monthly balance of the account. </li>
</ul>

<h2>Purpose of This Example</h2>

<p>This example builds on the Fraud Detection Cache example. It will demonstrate the following features</p>
<h3>HTTP channel security (HTTPS)</h3>
<ol>For channel security, the example project uses a self-signed PKCS12 certificate. This example will use a one way SSL where the browser will be presented with the BE server certificate during initial SSL handshake.</ol>
<h3>DataGrid Security : Transport - User Authentication - Data encryption</h3> 
	

<ol>For data grid security and authentication features, the example project is packaged with example security policy and token files (fdpolicy.txt, fdtoken.txt). These policy and token files were generated with as-admin utility using following commands</ol>

<pre class="commands">
Run <i>AS_HOME</i>/bin/as-admin
<b>as-admin></b>create security_policy policy_name 'fdpolicy/fddomain' policy_file 'fdpolicy.txt' identity_password 'fd$admin'
<b>as-admin></b>create security_token domain_name 'fddomain' policy_file 'fdpolicy.txt' create_identity token_file 'fdtoken.txt' domain_identity_password 'fd$admin'
</pre>
<p>The policy file has then been edited as follows. The policy file (fdpolicy.txt) has enabled restricted transport access 'transport_access=true;cert_file=fd_trusted_identities.txt', where fd_trusted_indentities
are nothing but the public keys from token files. (in this case from fdtoken.txt)</p>
<p>It has also enabled a user/password login-service based
authentication 'authentication=userpwd;source=system;service=login;hint=n/a'</p>
<p>As such, before running the example, edit the fdsecure.cdd and in the Object Management section and under "Security-Requester' supply your operating system login username and password (for Windows also supply the domain). </p>
<p><i><b>If you do not provide valid credentials, the 'default' PU will not be able to start.</b></i></p>
<p>It has enabled data encryption 'data_encryption=true' and encryption is enabled in the CDD for the 'PinCode' field</p>
<h2>How to Run the Example</h2>
<ol>

<li>
<p>Open a command window and at the command prompt, start the TIBCO BusinessEvents engine using the following command, to run the cache agent. Substitute your actual value for <i>BE_HOME</i>.</p>

<pre class="commands">
cd <i>BE_HOME</i>/examples/standard/FraudDetectionSecure
<i>BE_HOME</i>/bin/be-engine --propFile <i>BE_HOME</i>\bin\be-engine.tra -u cache -c FraudDetectionSecure/fdsecure.cdd fdsecure.ear
</pre>


</li>
<li>
<p>Open a second command window and at the command prompt, start the TIBCO BusinessEvents engine using the following command, to run the inference agent. Substitute your actual value for <i>BE_HOME</i>.</p>

<pre class="commands">
cd <i>BE_HOME</i>/examples/standard/FraudDetectionSecure
<i>BE_HOME</i>/bin/be-engine --propFile <i>BE_HOME</i>\bin\be-engine.tra -u default -c FraudDetectionSecure/fdsecure.cdd fdsecure.ear
</pre>
<p>Adapt these commands as needed, for example, if you have customized the example project, or are running it from a different directory. You may also change the policy settings in fdpolicy.txt
and provide appropriate credentials in the 'Security-Requester' or overrides in the 'Processing Units' settings. Refer to the documentation for further details.</p>


</li>
<li>
<p>After the 'default' processing unit has started its HTTP channel successfully, click on the link below to continue. This will cause the browser to reload this page from the BE server, but over SSL.
This in turn, will cause the server to first send its certificate to this browser. Since the server's certificate is self-signed (not signed by a trusted authority),
the browser will prompt you to accept this untrusted certificate. You may accept the certificate and proceed.</p>
<a href="https://localhost:8109/standard/FraudDetectionSecure/readme.html#4">Click here to continue</a>
</li>
<li>

<p><a id="4"></a>Create an account and give it a balance and an average monthly balance. Enter a name in the Account ID field. Enter, for example, 10000 in the Balance, and 20000 in the AvgMonthlyBalance fields. Repeat this step to create multiple accounts, as desired.</p>

<form id="createAccountForm"></form>

<p>In the command window you see a message like this:
<span class="logs">#### Created account Bob.</span></a></p>
</li>


<li>
<p>Now debit the account. In the AccountId field, enter one of the account names you specified above. Enter the amount of the debit in the Amount field. Then click Send.</p>

<form id="debitAccountForm"></form>

<p>In the command window you see messages like this
(the actual message depends on the account balance, the average monthly balance, and other events that happened in the two minute window):
<span class="logs">#### Debiting account Bob by $1000.0</span></p>
</li>


<li>
<p>Rules in the project react to various inputs depending on current facts in the Rete network. You can try the following.</p>
<p><Strong>Note</strong> At any time between data inputs, stop the engine that is running the inference engine and start it again. You can see that the state of the account and the customer concepts is still available when the engine restarts, because the data is stored in the cache agent. However if you stop the engine running the cache agent and restart it, no data persists. To ensure persistence of data in cache, you would add a backing store, as explained in <i>TIBCO BusinessEvents Administration</i>.</p>

<table>
<tr>
<th>Action</th>
<th>Message</th>
</tr>
<tr>
<td>In the /Events/CreateAccount form, enter the same account name two times.</td>
<td><pre class="logs">#### Account already exists: Bob</pre></td>
</tr>
<tr>
<td>In the /Events/Debit form, enter wrong pin code.</td>
<td><pre class="logs">#### Wrong pin code entered! Please retry operation.</pre></td>
</tr>
<tr>
<td>In the /Events/Debit form, enter a debit amount greater than the account balance.</td>
<td><pre class="logs">#### Account ID Bob STATUS set to Suspended. <br>Balance -1000.0 is less than zero</pre></td>
</tr>
<tr>
<td>In the Events/Debit form, debit an account that was set to Suspended.</td>
<td><pre class="logs">#### Cannot debit the suspended account Bob</pre></td>
</tr>
<tr>
<td>In the Events/Debit form, match the fraud detection criteria to meet both of the following conditions:
<ul>
<li>Make 3 debits within 2 minutes</li>
<li>Make debits such that the sum of the debits occurring in a two minute period totals more than 80% of the average monthly balance of the account.</li>
</ul></td>
<td><pre class="logs">#### Account ID Bob STATUS set to Suspended. <br>Fraud suspected</pre></td>
</tr>
</table>
</li>

<li>
<p>Open a second command window and at the command prompt, start the TIBCO ActiveSpaces admin utility using the following command. Join the metaspace and verify that the Account PinCode field is <i>Encrypted</i>.</p>

<pre class="commands">
Run <i>AS_HOME</i>/bin/as-admin
<b>as-admin></b>connect name 'fdsecure' discovery 'tcp://127.0.0.1:32767' listen 'tcp://127.0.0.1:32766' security_token 'fdtoken.txt' identity_password 'fd$admin'
<b>as-admin></b>show space 'dist-unlimited-nobs-fdsecure--be_gen_Concepts_Account'
</pre>
</li>

<li>
<p> To reset the data, restart the engine running the cache agent at the command line.</p>
</li>

</ol>



<div class="footer">
<p>TIBCO BusinessEvents&reg; 5.6<br />
Copyright&copy; 2004-2019 TIBCO Software Inc. All rights reserved.</p>
</div>
</body>
</html>
